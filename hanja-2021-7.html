<!doctype html>  
<html lang="ko"> 
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
        <title>대한민국한자급수자격검정시험 - 91회</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
        <style>
            .hanja {
                font-size: x-large;
            }
            .resultTitle {
                text-align: center;
                font-size: larger;
                text-decoration: underline;
            }
            .resultReport {
                text-align: center; 
                padding-bottom: 10px;
            }
            .footer {
                text-align:center; 
                height: 45px; 
                padding-top: 10px; 
                background-color: #eeeeee;
            }
        </style>
        <script>
            const list = [
{ seq:'1', hanja:'九', mean:'아홉', sound:'구'}, 
{ seq:'2', hanja:'金', mean:'쇠', sound:'금'}, 
{ seq:'3', hanja:'南', mean:'남녘', sound:'남'}, 
{ seq:'4', hanja:'男', mean:'사내', sound:'남'}, 
{ seq:'5', hanja:'女', mean:'여자', sound:'녀'}, 
{ seq:'6', hanja:'東', mean:'동녘', sound:'동'}, 
{ seq:'7', hanja:'六', mean:'여섯', sound:'륙'}, 
{ seq:'8', hanja:'母', mean:'어머니', sound:'모'}, 
{ seq:'9', hanja:'木', mean:'나무', sound:'목'}, 
{ seq:'10', hanja:'門', mean:'문', sound:'문'}, 
{ seq:'11', hanja:'父', mean:'아버지', sound:'부'}, 
{ seq:'12', hanja:'北', mean:'북녘', sound:'북'}, 
{ seq:'13', hanja:'四', mean:'넉', sound:'사'}, 
{ seq:'14', hanja:'三', mean:'석', sound:'삼'}, 
{ seq:'15', hanja:'西', mean:'서녘', sound:'서'}, 
{ seq:'16', hanja:'水', mean:'물', sound:'수'}, 
{ seq:'17', hanja:'十', mean:'열', sound:'십'}, 
{ seq:'18', hanja:'五', mean:'다섯', sound:'오'}, 
{ seq:'19', hanja:'月', mean:'달', sound:'월'}, 
{ seq:'20', hanja:'二', mean:'두', sound:'이'}, 
{ seq:'21', hanja:'人', mean:'사람', sound:'인'}, 
{ seq:'22', hanja:'日', mean:'날', sound:'일'}, 
{ seq:'23', hanja:'一', mean:'한', sound:'일'}, 
{ seq:'24', hanja:'子', mean:'아들', sound:'자'}, 
{ seq:'25', hanja:'弟', mean:'아우', sound:'제'}, 
{ seq:'26', hanja:'七', mean:'일곱', sound:'칠'}, 
{ seq:'27', hanja:'土', mean:'흙', sound:'토'}, 
{ seq:'28', hanja:'八', mean:'여덟', sound:'팔'}, 
{ seq:'29', hanja:'兄', mean:'맏', sound:'형'}, 
{ seq:'30', hanja:'火', mean:'불', sound:'화'}, 
{ seq:'31', hanja:'江', mean:'강', sound:'강'}, 
{ seq:'32', hanja:'口', mean:'입', sound:'구'}, 
{ seq:'33', hanja:'內', mean:'안', sound:'내'}, 
{ seq:'34', hanja:'年', mean:'해', sound:'년'}, 
{ seq:'35', hanja:'大', mean:'큰', sound:'대'}, 
{ seq:'36', hanja:'目', mean:'눈', sound:'목'}, 
{ seq:'37', hanja:'白', mean:'흰', sound:'백'}, 
{ seq:'38', hanja:'山', mean:'메(뫼)', sound:'산'}, 
{ seq:'39', hanja:'上', mean:'위', sound:'상'}, 
{ seq:'40', hanja:'小', mean:'작을 ', sound:'소'}, 
{ seq:'41', hanja:'手', mean:'손', sound:'수'}, 
{ seq:'42', hanja:'外', mean:'바깥', sound:'외'}, 
{ seq:'43', hanja:'右', mean:'오른', sound:'우'}, 
{ seq:'44', hanja:'入', mean:'들', sound:'입'}, 
{ seq:'45', hanja:'足', mean:'발', sound:'족'}, 
{ seq:'46', hanja:'左', mean:'왼', sound:'좌'}, 
{ seq:'47', hanja:'中', mean:'가운데', sound:'중'}, 
{ seq:'48', hanja:'靑', mean:'푸를', sound:'청'}, 
{ seq:'49', hanja:'出', mean:'날', sound:'출'}, 
{ seq:'50', hanja:'下', mean:'아래', sound:'하'}
            ];
            const listSize = list.length;
            let examList = [];
            let examIdx = 0;

            window.onload = function() {
                initViewAll();
            }

            function showMenu(menuId) {
                document.querySelectorAll(".viewArea").forEach(el => el.style.display = "none");
                document.querySelector("#" + menuId).style.display = "block";

                if (menuId == "viewAll") {
                    document.querySelector("#btnExamStart").style.display = "block";
                }
            }

            function initViewAll() {
                let tbodyObj = document.querySelector("#viewAll table tbody");
                tbodyObj.innerHTML = "";
                let allTrText = "";
                list.forEach(data => {
                    let trText = "<tr>";
                    trText += `<td>${data.seq}</td>`;
                    trText += `<td class="hanja">${data.hanja}</td>`;
                    trText += `<td>${data.mean}</td>`;
                    trText += `<td>${data.sound}</td>`;
                    trText += "</tr>";
                    allTrText += trText;
                });
                tbodyObj.innerHTML = allTrText;
            }

            function handleBtnExamStart(that) {
                showMenu("viewExam");
                resetExamCard();
                startPresentExamCard();
            }

            function handleBtnExamNext(that) {
                let answer = "";
                document.getElementsByName("question").forEach(el => {
                    if (el.checked) {
                        answer = el.value;
                    }
                });
                if (answer == "") {
                    alert("답을 선택하세요.");
                    return;
                }

                let item = examList[examIdx-1];
                item.answer = answer;
                item.result = (getRightAnswer(item) == answer) ? "O" : "X";

                presentExamCard();
            }

            function handleBtnExamResultCopy() {
                let copyText = "대한검정회 한자급수 - 7급" + "\n";
                copyText += "-" + document.querySelector("#viewResult .resultTitle").innerText + "\n";
                copyText += "-" + document.querySelector("#viewResult .resultReport").innerText + "\n";
                let tempExamList = Array.prototype.slice.call(examList);
                tempExamList.sort((a, b) => a.result < b.result ? -1 : a.result > b.result ? 1 : 0);
                tempExamList.forEach((item, index) => {
                    let result = item.result; 
                    let failAnswerText = getFailAnswerText(item);
                    copyText += `[${result}] ${index+1}. ${item.hanja} ${getRightAnswer(item)} ${failAnswerText} \n`;
                });

                const t = document.createElement("textarea");
                document.body.appendChild(t);
                t.value = copyText;
                t.select();
                document.execCommand('copy');
                document.body.removeChild(t);

                let alertText = "";
                alertText += "결과가 복사되었습니다.\n";
                alertText += "원하는곳에 붙여넣기 하세요. ^^";
                alert(alertText);
            }      

            function getRightAnswer(item) {
                return item.mean + " " + item.sound;
            }

            function handleBtnExamEnd(that) {
                showMenu("viewResult");
                presentResult();
            }

            function handleBtnViewAll(that) {
                showMenu("viewAll");
            }

            function resetExamCard() {
                document.querySelector("#btnExamStart").style.display = "none";
                document.querySelector(".examCard").style.display = "block";
                createExamList();
            }

            function startPresentExamCard() {
                examIdx = 0;
                presentExamCard();
            }

            function presentExamCard() {
                if (examIdx == listSize) {
                    showMenu("viewEnd");
                    return;
                }
                const item = examList[examIdx];
                document.querySelector(".examCard .card-title").innerHTML = item.hanja;                
                createQuestionText(document.querySelector(".examCard .questions"), item);

                document.querySelector("#btnExamNext").innerText = `(${examIdx+1} / ${examList.length}) 다음`;

                examIdx++;
            }

            function createQuestionText(el, item) {
                let questionsText = "";
                item.questions.forEach(question => {
                    questionsText += `<label class="list-group-item examQuestion">
                                            <input class="form-check-input me-1" type="radio" name="question" value="${question}">
                                            ${question}
                                        </label>`;
                });
                el.innerHTML = "";
                el.innerHTML = questionsText;
            }

            function presentResult() {
                document.querySelector("#viewResult .resultTitle").innerHTML = getFormatDate(new Date());

                const okResultCnt = examList.filter(item => item.result == "O").length;
                const failResultCnt = examList.filter(item => item.result == "X").length;
                const resultReportText = `Total: ${examList.length}, Ok: ${okResultCnt}, Fail: ${failResultCnt}`;
                document.querySelector("#viewResult .resultReport").innerHTML = resultReportText;

                document.querySelector("#viewResult .resultList .list-group").innerHTML = "";
                examList.forEach((item, idx) => createResultLine(item, idx+1));
            }

            function getFormatDate(date) {
                let year = date.getFullYear();
                let month = getNumberToTwoLengthText(date.getMonth() + 1);
                let day = getNumberToTwoLengthText(date.getDate());
                let hours = getNumberToTwoLengthText(date.getHours());
                let minutes = getNumberToTwoLengthText(date.getMinutes());
                let secondes = getNumberToTwoLengthText(date.getSeconds());
                return `${year}.${month}.${day} ${hours}:${minutes}:${secondes}`;
            }

            function getNumberToTwoLengthText(numberVal) {
                return (numberVal >= 10) ? numberVal : "0" + numberVal;
            }

            function createResultLine(item, idx) {
                const result = item.result;
                const failAnswerText = getFailAnswerText(item);
                const resultBadgeClass = (result == "X") ? "bg-danger" : "bg-success";
                const resultLine =  `<li class="list-group-item d-flex justify-content-between align-items-start">
                                        <div class="ms-2 me-auto">
                                            <div class="fw-bold">${item.hanja} <span style="color:#777777;">${getRightAnswer(item)}</span></div>
                                            <span style="color:#aaaaaa;">${failAnswerText}</span>
                                        </div>
                                        <span class="badge ${resultBadgeClass}">${result}</span>
                                    </li>`;
                document.querySelector("#viewResult .resultList .list-group").innerHTML +=  resultLine;
            }

            function getFailAnswerText(item) {
                return (item.result == "X") ?  `(선택한 답: ${item.answer})` : "";
            }

            function createExamList() {
                examList = []; // 재응시 관련 초기화
                examList = Array.prototype.slice.call(list);
                shuffle(examList);
                createQuestions();
            }

            function createQuestions() {
                examList.forEach(item => {
                    const itemIdx = examList.findIndex(el => el.seq == item.seq);
                    let tempList = Array.prototype.slice.call(list);
                    tempList.splice(itemIdx, 1);
                    shuffle(tempList);

                    let questions = [];
                    questions.push(item);
                    questions.push(tempList[0]);
                    questions.push(tempList[1]);
                    questions.push(tempList[2]);
                    shuffle(questions);

                    item.questions = [
                        questions[0].mean + " " + questions[0].sound,
                        questions[1].mean + " " + questions[1].sound,
                        questions[2].mean + " " + questions[2].sound,
                        questions[3].mean + " " + questions[3].sound,
                    ];                    
                });
            }

            function shuffle(a) { 
                var j, x, i; 
                for (i = a.length; i; i -= 1) { 
                    j = Math.floor(Math.random() * i); 
                    x = a[i - 1]; 
                    a[i - 1] = a[j]; 
                    a[j] = x; 
                } 
            }
        </script>
    </head>
    <body id="capture">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">대한검정회 한자급수 - 7급</a>
                <button 
                    class="btn btn-outline-primary" 
                    type="button" 
                    id="btnExamStart" 
                    onclick="handleBtnExamStart(this)">시험보기</button>
            </div>
        </nav>
        <div class="container" style="padding: 10px;">

            <div class="viewArea" id="viewAll" style="display: block;">
                <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">#</th>
                        <th scope="col">한자</th>
                        <th scope="col">뜻</th>
                        <th scope="col">음</th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>

            <div class="viewArea" id="viewExam" style="display: none;">
                <div class="card border-dark examCard" style="display: none;">
                  <div class="card-body">
                    <h5 class="card-title" style="text-align: center; font-size: 400%;"></h5>
                    <p class="card-text">
                        <div class="list-group questions"></div>
                    </p>
                    <div class="d-grid">
                        <button 
                            class="btn btn-primary" 
                            type="button"
                            id="btnExamNext"
                            onclick="handleBtnExamNext(this)">다음</button>
                    </div>
                  </div>
                </div>
                <div class="d-grid">
                    <button 
                        class="btn btn-outline-warning" 
                        type="button" 
                        style="margin-top: 5px;"
                        onclick="handleBtnExamStart(this)">재시험</button>
                    <button 
                        class="btn btn-outline-success" 
                        type="button" 
                        style="margin-top: 5px;"
                        onclick="handleBtnViewAll(this)">한자 목록 보기</button>
                </div>
            </div>

            <div class="viewArea" id="viewEnd" style="display: none;">
                <div class="card border-dark">
                    <div class="card-body">
                        <h5 class="card-title" style="text-align: center; font-size: 200%;">
                            "완료"
                        </h5>
                        <p class="card-text" style="text-align: center;">
                            모든 문제를 풀었습니다.<br>
                            결과를 확인하세요.
                        </p>
                        <div class="d-grid">
                            <button 
                                class="btn btn-primary" 
                                type="button"
                                id="btnExamEnd"
                                onclick="handleBtnExamEnd(this)">결과확인</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="viewArea" id="viewResult" style="display: none;">
                <div class="card border-dark">
                    <div class="card-body">
                        <div class="resultTitle"></div>
                        <div class="resultReport"></div>
                        <div class="resultList">
                            <ul class="list-group list-group-numbered"></ul>
                        </div>
                        <div class="d-grid" style="margin-top: 10px;">
                            <button 
                                class="btn btn-primary" 
                                type="button" 
                                id="btnExamResultCopy" 
                                onclick="handleBtnExamResultCopy(this)">결과 복사</button>
                        </div>
                    </div>
                </div>
                <div class="d-grid">
                    <button 
                        class="btn btn-outline-warning" 
                        type="button" 
                        style="margin-top: 5px;"
                        onclick="handleBtnExamStart(this)">재시험</button>
                    <button 
                        class="btn btn-outline-success" 
                        type="button" 
                        style="margin-top: 5px;"
                        onclick="handleBtnViewAll(this)">한자 목록 보기</button>
                </div>
            </div>
        </div>
        <div class="footer">
            시험일시 : 2021년 05월 29일(토) 오후 1:40
        </div>

    </body>
</html>
